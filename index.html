<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒ ÎŸÎ¹ Î¤Î±Î¾Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ¿Î¯ ÎœÎ±Ï‚ Î£Ï„ÏŒÏ‡Î¿Î¹</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
  <style>
    /* -----------------------------
       VARIABLE DEFAULTS
    ------------------------------*/
    :root{
      --text:#222; --accent:#6c63ff;
      --bg1:#e3f2fd; --bg2:#fce4ec;
      --surface: rgba(255,255,255,0.85);
      --card-surface:#ffffff;
      --shadow: 0 6px 18px rgba(0,0,0,.08);
      /* variant gradients (per-theme overrides below) */
      --v1a:#8ec5fc; --v1b:#e0c3fc;
      --v2a:#f6d365; --v2b:#fda085;
      --v3a:#a1c4fd; --v3b:#c2e9fb;
      --v4a:#f093fb; --v4b:#f5576c;
      --v5a:#84fab0; --v5b:#8fd3f4;
      --success:#49b568;
      --radius:18px;
    }

    /* -----------------------------
       THEMES (LIGHT + DARK VARIANTS)
       (kept exactly from your version)
    ------------------------------*/

    /* CANDY */
    [data-theme="candy"][data-mode="light"]{
      --text:#222; --accent:#6c63ff;
      --bg1:#e3f2fd; --bg2:#fce4ec;
      --surface: rgba(255,255,255,0.85); --card-surface:#fff; --shadow:0 6px 18px rgba(0,0,0,.08);
      --v1a:#8ec5fc; --v1b:#e0c3fc; --v2a:#f6d365; --v2b:#fda085; --v3a:#a1c4fd; --v3b:#c2e9fb; --v4a:#f093fb; --v4b:#f5576c; --v5a:#84fab0; --v5b:#8fd3f4;
    }
    [data-theme="candy"][data-mode="dark"]{
      --text:#f3f3f7; --accent:#a9a4ff;
      --bg1:#2b2d42; --bg2:#1a1b25;
      --surface: rgba(30,32,45,0.65); --card-surface:#242639; --shadow:0 8px 20px rgba(0,0,0,.5);
      --v1a:#6b8afc; --v1b:#a48bff; --v2a:#d8a85d; --v2b:#e27d67; --v3a:#6aa1fd; --v3b:#86c2fb; --v4a:#cc7ff0; --v4b:#d44a62; --v5a:#66d6a1; --v5b:#6bbfda;
    }

    /* OCEAN */
    [data-theme="ocean"][data-mode="light"]{
      --text:#0f1b2d; --accent:#0277bd;
      --bg1:#e0f7fa; --bg2:#e3f2fd;
      --surface: rgba(255,255,255,0.8); --card-surface:#ffffff;
      --v1a:#89f7fe; --v1b:#66a6ff; --v2a:#6dd5ed; --v2b:#2193b0; --v3a:#43cea2; --v3b:#185a9d; --v4a:#2BC0E4; --v4b:#EAECC6; --v5a:#74ebd5; --v5b:#ACB6E5;
    }
    [data-theme="ocean"][data-mode="dark"]{
      --text:#eaf7ff; --accent:#5fb3ff;
      --bg1:#0f172a; --bg2:#0b1020;
      --surface: rgba(10,14,30,0.6); --card-surface:#0f1b2d;
      --v1a:#2a5fa3; --v1b:#3b88ff; --v2a:#1b5c72; --v2b:#0f3d52; --v3a:#287a6b; --v3b:#143b61; --v4a:#1f7aa1; --v4b:#6a7c4f; --v5a:#2f7e75; --v5b:#485c89;
    }

    /* SUNSET */
    [data-theme="sunset"][data-mode="light"]{
      --text:#2b1d1d; --accent:#ff6f61;
      --bg1:#fff1eb; --bg2:#ace0f9;
      --surface: rgba(255,255,255,0.85); --card-surface:#ffffff;
      --v1a:#f6d365; --v1b:#fda085; --v2a:#ff9966; --v2b:#ff5e62; --v3a:#f7797d; --v3b:#FBD786; --v4a:#ff9a9e; --v4b:#fecfef; --v5a:#fcb69f; --v5b:#ffecd2;
    }
    [data-theme="sunset"][data-mode="dark"]{
      --text:#fff3ef; --accent:#ffa295;
      --bg1:#2b1b1f; --bg2:#1c1524;
      --surface: rgba(40,28,32,0.6); --card-surface:#261a1d;
      --v1a:#b87e4c; --v1b:#b75447; --v2a:#a34c2b; --v2b:#7d2a2d; --v3a:#9c4d50; --v3b:#7a6530; --v4a:#a25d61; --v4b:#7c5869; --v5a:#9d6c5b; --v5b:#6f4b35;
    }

    /* FOREST */
    [data-theme="forest"][data-mode="light"]{
      --text:#102114; --accent:#2e7d32;
      --bg1:#e8f5e9; --bg2:#e3f2fd;
      --surface: rgba(255,255,255,0.85); --card-surface:#ffffff;
      --v1a:#84fab0; --v1b:#8fd3f4; --v2a:#a8e063; --v2b:#56ab2f; --v3a:#11998e; --v3b:#38ef7d; --v4a:#c1dfc4; --v4b:#deecdd; --v5a:#70e1f5; --v5b:#ffd194;
    }
    [data-theme="forest"][data-mode="dark"]{
      --text:#e8fff0; --accent:#7fe387;
      --bg1:#0e1a12; --bg2:#0a151f;
      --surface: rgba(12,26,20,0.6); --card-surface:#0f1a14;
      --v1a:#2d7d5f; --v1b:#2f6b7d; --v2a:#466e25; --v2b:#2c5e1a; --v3a:#0f5b54; --v3b:#1f7e53; --v4a:#3b5f41; --v4b:#2f4334; --v5a:#2d6a75; --v5b:#755a2d;
    }

    /* MONO */
    [data-theme="mono"][data-mode="light"]{
      --text:#111827; --accent:#111827;
      --bg1:#f3f4f6; --bg2:#e5e7eb;
      --surface: rgba(255,255,255,0.75); --card-surface:#f9fafb;
      --v1a:#d1d5db; --v1b:#9ca3af; --v2a:#cbd5e1; --v2b:#94a3b8; --v3a:#e5e7eb; --v3b:#9ca3af; --v4a:#d4d4d4; --v4b:#a3a3a3; --v5a:#c7c7c7; --v5b:#9b9b9b;
    }
    [data-theme="mono"][data-mode="dark"]{
      --text:#e5e7eb; --accent:#e5e7eb;
      --bg1:#0b0c10; --bg2:#111217;
      --surface: rgba(18,19,24,0.7); --card-surface:#121318;
      --v1a:#3f3f46; --v1b:#27272a; --v2a:#334155; --v2b:#1f2937; --v3a:#404040; --v3b:#262626; --v4a:#3a3a3a; --v4b:#1f1f1f; --v5a:#343a40; --v5b:#151a1e;
    }

    /* FLOWERS (adds side petals overlay) */
    [data-theme="flowers"][data-mode="light"]{
      --text:#2b1d1d; --accent:#c2185b;
      --bg1:#fff0f5; --bg2:#e6f3ff;
      --surface: rgba(255,255,255,0.82); --card-surface:#ffffff;
      --v1a:#ffafbd; --v1b:#ffc3a0; --v2a:#fbc2eb; --v2b:#a6c1ee; --v3a:#fa709a; --v3b:#fee140; --v4a:#fddb92; --v4b:#d1fdff; --v5a:#a18cd1; --v5b:#fbc2eb;
    }
    [data-theme="flowers"][data-mode="dark"]{
      --text:#ffeef4; --accent:#ffa6c5;
      --bg1:#2a0f1b; --bg2:#0e1b2a;
      --surface: rgba(32,19,27,0.7); --card-surface:#20131b;
      --v1a:#a96a78; --v1b:#9a6d54; --v2a:#8a6ea6; --v2b:#55649b; --v3a:#8d3d58; --v3b:#6a5a1e; --v4a:#7e6736; --v4b:#486a6d; --v5a:#6e5b8a; --v5b:#8a6e83;
    }

    /* -----------------------------
       GLOBAL LAYOUT + BASE STYLES
    ------------------------------*/
    body{
      margin:0; min-height:100vh; font-family:'Inter',sans-serif;
      color:var(--text);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      background-size:200% 200%;
      animation:bgshift 18s ease-in-out infinite;
      display:flex; flex-direction:column; align-items:center;
      padding:40px 15px 96px; overflow-x:hidden;
      transition: background .6s ease, color .35s ease;
    }
    @keyframes bgshift { 0%,100%{background-position:0 0} 50%{background-position:100% 100%} }

    h1{ font-family:'Playfair Display',serif; font-size:2.4rem; margin:0 0 18px; color:var(--accent); text-align:center; }

    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; justify-content:center; z-index:5; }
    .toolbar select,.toolbar button{
      border:none;border-radius:12px;padding:8px 12px;background:var(--surface);color:var(--text);
      box-shadow:0 2px 6px rgba(0,0,0,.08);font:600 .9rem/1 'Inter',sans-serif;
      cursor:pointer;transition:transform .25s ease,background .25s ease;backdrop-filter:blur(6px);
    }
    .toolbar select:hover,.toolbar button:hover{ transform:translateY(-2px); }

    /* High-contrast dropdown text in dark mode */
    select{ color:var(--text); background:var(--surface); }
    option{ color:#111; background:#fff; }
    [data-mode="dark"] option{ color:#fff; background:#11131a; }

    .grid{ width:100%; max-width:1200px; display:grid; gap:18px; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); }

    /* Side petals overlay only for Flowers theme */
    .side-petals{
      position: fixed; inset: 0;
      pointer-events:none; display:none; /* enabled by JS for theme=flowers */
    }
    .side-petals .left,.side-petals .right{
      position:absolute; top:-20%; bottom:-20%; width:12%;
      opacity:.22; filter:saturate(.9);
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><text y="22" font-size="22">ğŸŒ¸</text></svg>'),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><text y="22" font-size="22">ğŸŒ¼</text></svg>'),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><text y="22" font-size="22">ğŸŒº</text></svg>');
      background-repeat: repeat; background-size: 44px 44px, 36px 36px, 40px 40px;
      animation: petalsFall 18s linear infinite;
      mask-image: linear-gradient(90deg, rgba(0,0,0,1), rgba(0,0,0,.5), rgba(0,0,0,0));
      z-index:1;
    }
    .side-petals .left{ left:0; }
    .side-petals .right{ right:0; transform: scaleX(-1); }
    @keyframes petalsFall{
      0%{ background-position: 0 0, 0 0, 0 0; opacity:.05; }
      40%{ opacity:.28; }
      100%{ background-position: 0 900px, 0 1200px, 0 1000px; opacity:.05; }
    }

    /* Cards */
    .card{
      position:relative;height:290px;border-radius:var(--radius);overflow:hidden;cursor:pointer;
      perspective:1000px;opacity:0;transform:translateY(14px) scale(.98);
      animation:cardIn .6s forwards; box-shadow:var(--shadow);
      transition:transform .55s cubic-bezier(.17,.67,.83,.67), box-shadow .4s ease;
      background: var(--card-surface);
      z-index:2;
    }
    @keyframes cardIn{ to{opacity:1; transform:translateY(0) scale(1)} }
    .card:hover{ transform:translateY(-6px) scale(1.02); box-shadow:0 12px 28px rgba(0,0,0,.12); }

    /* Japan â€” same size, ALWAYS VISIBLE & LAST, SOFT PULSE on hover/flip */
    .card.japan{
      position:relative;
      border:2px solid #fff;
    }
    .card.japan .front{
      background: linear-gradient(135deg, #ff4b91, #ffb6c1);
      color:#fff;
    }
    .card.japan::before{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:0;
      background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><text y="20" font-size="20">ğŸŒ¸</text></svg>');
      background-size:40px 40px; background-repeat:repeat;
      opacity:0; transition:opacity .5s ease;
      animation: petalsInside 14s linear infinite;
    }
    @keyframes petalsInside{ from{ background-position-y:0 } to{ background-position-y:700px } }
    .card.japan:hover::before, .card.japan.flipped::before{ opacity:.35; }
    .card.japan:hover .front, .card.japan.flipped .front{
      animation: pinkPulse 1.8s ease-in-out infinite;
    }
    @keyframes pinkPulse{
      0%,100%{ box-shadow:0 0 12px rgba(255,102,178,.4), 0 0 0 rgba(255,102,178,0); }
      50%{ box-shadow:0 0 26px rgba(255,102,178,.85), 0 0 60px rgba(255,102,178,.25); }
    }

    .card-content{ position:relative; z-index:1; width:100%; height:100%; transform-style:preserve-3d; transition: transform .85s cubic-bezier(.4,.2,.2,1); }
    .card.flipped .card-content{ transform: rotateY(180deg); }

    .front,.back{
      position:absolute; inset:0; border-radius:var(--radius);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:18px; backface-visibility:hidden; box-sizing:border-box;
    }
    .front{ color:#fff; text-align:center; font-weight:600; }
    .front h3{ margin:0; font-size:1.4rem; display:flex; gap:.35em; align-items:center; justify-content:center; }

    /* Per-card variants (theme-driven vars) */
    .variant-1 .front{ background: linear-gradient(135deg,var(--v1a),var(--v1b)); }
    .variant-2 .front{ background: linear-gradient(135deg,var(--v2a),var(--v2b)); }
    .variant-3 .front{ background: linear-gradient(135deg,var(--v3a),var(--v3b)); }
    .variant-4 .front{ background: linear-gradient(135deg,var(--v4a),var(--v4b)); }
    .variant-5 .front{ background: linear-gradient(135deg,var(--v5a),var(--v5b)); }

    .front::after{
      content:""; position:absolute; inset:-40%;
      background: radial-gradient( circle at 30% 0%, rgba(255,255,255,.25), transparent 40% );
      transform: translateX(-60%) rotate(15deg);
      transition: transform .8s ease, opacity .8s ease; opacity:0;
    }
    .card:hover .front::after{ transform: translateX(15%) rotate(15deg); opacity:.9; }

    .back{ background: var(--card-surface); color:var(--text); transform: rotateY(180deg); text-align:center; }
    .back img{ width:100%; height:150px; object-fit:cover; border-radius:12px; border:1px solid rgba(0,0,0,.06); margin-bottom:10px; }
    .back p{ margin:0 0 10px; font-size:.95rem; }
    .visit-row{ display:flex; gap:.5rem; align-items:center; justify-content:center; flex-wrap:wrap; }
    .visit-date{ font-size:.9rem; margin-top:6px; opacity:.95; }

    .checkmark{ position:absolute; top:10px; right:10px; font-size:1.35rem; color:var(--success); opacity:0; transition:opacity .3s ease; filter: drop-shadow(0 1px 2px rgba(0,0,0,.2)); }
    .card.checked .checkmark{ opacity:1; }

    .chips{ position:absolute; left:10px; top:10px; display:flex; gap:6px; }
    .chip{
      font-size:.72rem; font-weight:700; letter-spacing:.02em;
      padding:4px 8px; border-radius:999px;
      background:rgba(255,255,255,.25); color:#fff;
      backdrop-filter: blur(4px);
      box-shadow: 0 1px 2px rgba(0,0,0,.12);
    }

    /* Progress */
    .progress{ position:fixed; left:0; right:0; bottom:0; height:8px; background:rgba(0,0,0,.08); }
    .progress .fill{ height:100%; width:0%; background:var(--accent); transition:width .4s ease; }
    .progress-text{
      position:fixed; bottom:14px; left:50%; transform:translateX(-50%);
      background:var(--surface); padding:4px 10px; border-radius:10px; font-size:.9rem;
      box-shadow:0 2px 6px rgba(0,0,0,.08); backdrop-filter: blur(6px);
    }

    @media (max-width: 620px){ .card{ height:270px; } .front h3{ font-size:1.25rem; } }
  </style>
</head>
<body data-theme="candy" data-mode="light">
  <h1>ÎŸÎ¹ Î¤Î±Î¾Î¹Î´Î¹Ï‰Ï„Î¹ÎºÎ¿Î¯ ÎœÎ±Ï‚ Î£Ï„ÏŒÏ‡Î¿Î¹</h1>

  <div class="toolbar">
    <select id="theme">
      <option value="candy">ğŸ¨ Candy</option>
      <option value="ocean">ğŸŒŠ Ocean</option>
      <option value="sunset">ğŸŒ… Sunset</option>
      <option value="forest">ğŸŒ² Forest</option>
      <option value="mono">âš« Mono</option>
      <option value="flowers">ğŸŒ¸ Flowers</option>
    </select>

    <!-- One-click dark mode -->
    <button id="modeBtn">ğŸŒ™ Dark</button>

    <select id="filter">
      <option value="all">ÎŒÎ»Î¿Î¹</option>
      <option value="visited">Î•Ï€Î¹ÏƒÎºÎ­Ï†Ï„Î·ÎºÎ±</option>
      <option value="notVisited">Î”ÎµÎ½ Î­Ï‡Ï‰ Ï€Î¬ÎµÎ¹</option>
    </select>
  </div>

  <!-- Side petals (enabled only on Flowers theme) -->
  <div class="side-petals" id="sidePetals">
    <div class="left"></div>
    <div class="right"></div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="progress"><div class="fill"></div></div>
  <div class="progress-text" id="ptext">0% ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ</div>

  <script>
    // Core list WITHOUT Japan; we'll append Japan as the last card to guarantee visibility and position.
    const baseDestinations = [
      { name:"ğŸ‡¬ğŸ‡· ÎœÎµÏ„Î­Ï‰ÏÎ±", image:"./meteora.jpg", description:"Î£' Î±Î³Î±Ï€Ï", region:"Î•Î»Î»Î¬Î´Î±" },
      { name:"ğŸ‡ªğŸ‡¸ Î’Î±ÏÎºÎµÎ»ÏÎ½Î·", image:"./barcelona.jpg", description:"Te amo", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡«ğŸ‡· Î Î±ÏÎ¯ÏƒÎ¹", image:"./paris.jpg", description:"Je tâ€™aime", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡³ğŸ‡± Î†Î¼ÏƒÏ„ÎµÏÎ½Ï„Î±Î¼", image:"./amsterdam.jpg", description:"Ik hou van jou", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡®ğŸ‡¹ ÎœÎ¹Î»Î¬Î½Î¿", image:"./milan.jpg", description:"Ti amo", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡®ğŸ‡¹ Î’ÎµÎ½ÎµÏ„Î¯Î±", image:"./venice.jpg", description:"Ti amo", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡¦ğŸ‡¹ Î’Î¹Î­Î½Î½Î·", image:"./vienna.jpg", description:"Ich liebe dich", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡­ğŸ‡º Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·", image:"./budapest.jpg", description:"Szeretlek", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡¸ğŸ‡ª Î£Î¿Ï…Î·Î´Î¯Î±", image:"./sweden.jpg", description:"Jag Ã¤lskar dig", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡¨ğŸ‡­ Î•Î»Î²ÎµÏ„Î¯Î±", image:"./switzerland.jpg", description:"Ich liebe dich", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡«ğŸ‡® Î¦Î¹Î½Î»Î±Î½Î´Î¯Î±", image:"./finland.jpg", description:"Rakastan sinua", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡³ğŸ‡´ ÎÎ¿ÏÎ²Î·Î³Î¯Î±", image:"./norway.jpg", description:"Jeg elsker deg", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡®ğŸ‡¸ Î™ÏƒÎ»Î±Î½Î´Î¯Î±", image:"./iceland.jpg", description:"Ã‰g elska Ã¾ig", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡µğŸ‡¹ Î Î¿ÏÏ„Î¿Î³Î±Î»Î¯Î±", image:"./portugal.jpg", description:"Eu te amo", region:"Î•Ï…ÏÏÏ€Î·" },
      { name:"ğŸ‡¦ğŸ‡ª ÎÏ„Î¿Ï…Î¼Ï€Î¬Î¹", image:"./dubai.jpg", description:"Ø£Ø­Ø¨Ùƒ", region:"ÎœÎ­ÏƒÎ· Î‘Î½Î±Ï„Î¿Î»Î®" },
      { name:"ğŸ‡²ğŸ‡» ÎœÎ±Î»Î´Î¯Î²ÎµÏ‚", image:"./maldives.jpg", description:"Ş‰Ş¨Ş€Ş§ŞƒŞªŞŞ¬ Ş€Ş¦ŞŒŞ¦ŞƒŞª", region:"Î‘ÏƒÎ¯Î±" },
      { name:"ğŸ‡ªğŸ‡¬ Î‘Î¯Î³Ï…Ï€Ï„Î¿Ï‚", image:"./egypt.jpg", description:"Ø¨Ø­Ø¨Ùƒ", region:"Î‘Ï†ÏÎ¹ÎºÎ®" }
    ];

    const japanDestination = { name:"ğŸ‡¯ğŸ‡µ Î™Î±Ï€Ï‰Î½Î¯Î±", image:"./japan.jpg", description:"æ„›ã—ã¦ã‚‹", region:"Î‘ÏƒÎ¯Î±", special:true };

    const grid = document.getElementById('grid');
    const filterSel = document.getElementById('filter');
    const themeSel = document.getElementById('theme');
    const modeBtn = document.getElementById('modeBtn');
    const sidePetals = document.getElementById('sidePetals');
    const ptext = document.getElementById('ptext');

    // Restore saved state
    const savedTheme = localStorage.getItem('theme') || 'candy';
    const savedMode = localStorage.getItem('mode') || 'light';
    document.body.setAttribute('data-theme', savedTheme);
    document.body.setAttribute('data-mode', savedMode);
    themeSel.value = savedTheme;
    modeBtn.textContent = savedMode === 'light' ? 'ğŸŒ™ Dark' : 'â˜€ï¸ Light';

    let checked = JSON.parse(localStorage.getItem('checkedItems')||'[]');
    let visitDates = JSON.parse(localStorage.getItem('visitDates')||'{}');

    // Ensure Meteora (index 0 of base list) is visited with the fixed date
    const METEORA_IDX = 0;
    if(!checked.includes(METEORA_IDX)) checked.push(METEORA_IDX);
    if(!visitDates[METEORA_IDX]) visitDates[METEORA_IDX] = "2025-10-25";
    localStorage.setItem('checkedItems', JSON.stringify(checked));
    localStorage.setItem('visitDates', JSON.stringify(visitDates));

    toggleFlowersOverlay();

    function cardHTML(d, idx, isSpecial=false){
      const variant = ((idx) % 5) + 1; // keep variant cycle consistent
      const isChecked = checked.includes(idx);
      const specialClass = isSpecial ? 'japan' : '';
      return `
        <div class="card variant-${variant} ${specialClass} ${isChecked?'checked':''}" data-index="${idx}" data-special="${isSpecial}">
          <div class="card-content">
            <div class="front">
              <div class="chips"><span class="chip">${d.region||'â€”'}</span></div>
              <div class="checkmark">âœ…</div>
              <h3>${d.name}${isSpecial?' â›©ï¸':''}</h3>
            </div>
            <div class="back">
              <img src="${d.image}" alt="${d.name}" onerror="this.src='https://via.placeholder.com/600x350?text=No+Image'">
              <p>${d.description}</p>
              <div class="visit-row">
                <label style="display:inline-flex;gap:.45em;align-items:center;">
                  <input type="checkbox" ${isChecked?'checked':''}> Î•Ï€Î¹ÏƒÎºÎ­Ï†Ï„Î·ÎºÎ±
                </label>
              </div>
              <div class="visit-date" ${isChecked?'':'style="display:none"'}></div>
            </div>
          </div>
        </div>
      `;
    }

    function bindCardBehavior(card){
      const idx = Number(card.dataset.index);
      const checkbox = card.querySelector('input[type="checkbox"]');
      const dateEl = card.querySelector('.visit-date');

      // init date text if visited
      if(checked.includes(idx)){
        const iso = visitDates[idx] || todayISO();
        dateEl.style.display = 'block';
        dateEl.textContent = 'Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎµÏ€Î¯ÏƒÎºÎµÏˆÎ·Ï‚: ' + formatDate(iso);
      }

      checkbox.addEventListener('click', e=> e.stopPropagation());

      checkbox.addEventListener('change', e=>{
        const isNowChecked = e.target.checked;
        if(isNowChecked){
          if(!checked.includes(idx)) checked.push(idx);
          const iso = visitDates[idx] || todayISO();
          visitDates[idx] = iso;
          dateEl.style.display = 'block';
          dateEl.textContent = 'Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎµÏ€Î¯ÏƒÎºÎµÏˆÎ·Ï‚: ' + formatDate(iso);
        }else{
          checked = checked.filter(i=>i!==idx);
          delete visitDates[idx];
          dateEl.style.display = 'none';
        }
        localStorage.setItem('checkedItems', JSON.stringify(checked));
        localStorage.setItem('visitDates', JSON.stringify(visitDates));
        card.classList.toggle('checked', isNowChecked);
        updateProgress();
        applyFilterToCard(card); // Japan will be forced visible below
      });

      // flip card (ignore inputs)
      card.addEventListener('click', e=>{
        if(e.target.tagName.toLowerCase()==='input') return;
        card.classList.toggle('flipped');
      });
    }

    function build(){
      grid.innerHTML='';
      // Render base destinations first (indices 0..baseDestinations.length-1)
      baseDestinations.forEach((d, idx)=>{
        const html = cardHTML(d, idx, false);
        grid.insertAdjacentHTML('beforeend', html);
      });
      // Append Japan as LAST with a stable index equal to baseDestinations.length
      const japanIndex = baseDestinations.length; // e.g., 17 (kept separate)
      const japanHTML = cardHTML(japanDestination, japanIndex, true);
      grid.insertAdjacentHTML('beforeend', japanHTML);

      // Bind all cards
      [...grid.children].forEach(bindCardBehavior);

      applyFilterAll();
      updateProgress();
    }

    function todayISO(){
      const t=new Date(); const y=t.getFullYear(); const m=String(t.getMonth()+1).padStart(2,'0'); const d=String(t.getDate()).padStart(2,'0');
      return `${y}-${m}-${d}`;
    }
    function formatDate(iso){
      if(!iso) return '';
      const dt = new Date(iso);
      return dt.toLocaleDateString('el-GR',{year:'numeric',month:'short',day:'numeric'});
    }

    function applyFilterToCard(card){
      const isSpecial = card.dataset.special === 'true';
      if(isSpecial){
        // Japan: ALWAYS visible
        card.style.display = '';
        return;
      }
      const idx = Number(card.dataset.index);
      const visited = checked.includes(idx);
      const f = filterSel.value;
      const show = (f==='all') || (f==='visited' && visited) || (f==='notVisited' && !visited);
      card.style.display = show ? '' : 'none';
    }
    function applyFilterAll(){ [...grid.children].forEach(applyFilterToCard); }

    function updateProgress(){
      const fill = document.querySelector('.progress .fill');
      const total = baseDestinations.length + 1; // include Japan in total
      const v = checked.length;
      const pct = (v/total)*100;
      fill.style.width = `${pct}%`;
      ptext.textContent = `${Math.round(pct)}% ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ ${pct===100 ? 'ğŸ‰' : ''}`;
    }

    function toggleFlowersOverlay(){
      sidePetals.style.display = (themeSel.value === 'flowers') ? 'block' : 'none';
    }

    /* Controls */
    themeSel.addEventListener('change', ()=>{
      document.body.setAttribute('data-theme', themeSel.value);
      localStorage.setItem('theme', themeSel.value);
      toggleFlowersOverlay();
    });

    // One-click dark mode
    modeBtn.addEventListener('click', ()=>{
      const current = document.body.getAttribute('data-mode') || 'light';
      const next = current === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-mode', next);
      localStorage.setItem('mode', next);
      modeBtn.textContent = next === 'light' ? 'ğŸŒ™ Dark' : 'â˜€ï¸ Light';
    });

    filterSel.addEventListener('change', applyFilterAll);

    // Build once
    build();
  </script>
</body>
</html>
